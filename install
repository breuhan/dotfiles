#!/usr/bin/env bash

# TODO:
#   * Copy all OSX files from Library
#   * Configure OSX to use the files from Library
#   * Auto-Decode the ssh key
#   * Remove .bin and place ack in /usr/local/bin

#
# Main variables
#

toDir=$(pwd)
fromDir=~/

#
# Link all dotfiles from the current directory
#

for dir in $(ls -a1); do
    # Skip "." and ".."
    if [ "${dir}" == "." ] || [ "${dir}" == ".." ]; then
        continue
    fi

    # Skip the .git folder
    if [ "${dir}" == ".git" ]; then
        continue
    fi

    # Skip all "normal" (non hidden) files
    if [ "${dir:0:1}" != "." ]; then
        continue
    fi

    echo "Creating symlink for: ${dir}"

    linkFrom="${fromDir}/${dir}"
    linkTo="${toDir}/${dir}"

    rm -rf ${linkFrom}
    ln -s ${linkTo} ${linkFrom}
done

#
# Update git submodules
#

echo "Updating all git submodules"
git submodule update --init

#
# Install: git-flow-completion
#

echo "Creating symlink for: git-flow-completion"

gitFlowFrom="${fromDir}/.git-flow-completion.sh"
gitFlowTo="${toDir}/git-flow-completion/git-flow-completion.bash"

rm -rf ${gitFlowFrom}
ln -s ${gitFlowTo} ${gitFlowFrom}

#
# Install: rvm
#
echo "Install or update rvm"
bash < <(curl -s https://rvm.beginrescueend.com/install/rvm) &> /dev/null
rvm reload &> /dev/null
